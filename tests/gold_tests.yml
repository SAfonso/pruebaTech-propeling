version: 2

models:

  # --------------------
  # DIMENSIONES
  # --------------------
  - name: dim_customer
    columns:
      - name: CUSTOMER_ID
        tests: [not_null, unique]
      - name: CUSTOMER_NAME
        tests: [not_null]
      - name: CUSTOMER_PHONE
        tests: [not_null]

  - name: dim_suppliers
    columns:
      - name: SUPPLIER_ID
        tests: [not_null, unique]
      - name: SUPPLIER_NAME
        tests: [not_null]

  - name: dim_part
    columns:
      - name: PART_ID
        tests: [not_null, unique]
      - name: PART_NAME
        tests: [not_null]


  - name: dim_dates
    columns:
      - name: DATE_KEY
        tests: [not_null, unique]
      - name: DATE_VALUE
        tests: [not_null]
      - name: YEAR
        tests: [not_null]
      - name: MONTH
        tests: [not_null]
      - name: DAY
        tests: [not_null]

  # --------------------
  # HECHOS
  # --------------------
  - name: fact_lineitem
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns: [ORDER_KEY, L_LINENUMBER]
    columns:
      # FKs a dimensiones
      - name: CUSTOMER_KEY
        tests:
          - not_null
          - relationships:
              to: ref('dim_customer')
              field: CUSTOMER_ID
      - name: PART_KEY
        tests:
          - not_null
          - relationships:
              to: ref('dim_part')
              field: PART_ID
      - name: SUPPLIER_KEY
        tests:
          - not_null
          - relationships:
              to: ref('dim_suppliers')
              field: SUPPLIER_ID

      # FKs a dim_dates -> ahora son NUMÃ‰RICAS (DATE_KEY)
      - name: ORDER_DATE_KEY
        tests:
          - not_null
          - relationships:
              to: ref('dim_dates')
              field: DATE_KEY
      - name: SHIP_DATE_KEY
        tests:
          - not_null
          - relationships:
              to: ref('dim_dates')
              field: DATE_KEY
      - name: COMMIT_DATE_KEY
        tests:
          - not_null
          - relationships:
              to: ref('dim_dates')
              field: DATE_KEY
      - name: RECEIPT_DATE_KEY
        tests:
          - not_null
          - relationships:
              to: ref('dim_dates')
              field: DATE_KEY



  - name: fact_orders
    columns:
      - name: ORDERKEY
        tests: [not_null, unique]
      - name: CUSTOMER_KEY
        tests:
          - not_null
          - relationships:
              to: ref('dim_customer')
              field: CUSTOMER_ID
